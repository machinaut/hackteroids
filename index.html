<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <head>
    <title>HACKTEROIDS!</title>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="Soft03CritList_earth.js"></script>
    <script type="text/javascript">
        var ge;
        var loopTimer;
        google.load("earth", "1", {"other_params":"sensor=true"});
        console.log("Num Asteroids loaded:",data.length);

        function init() {
            google.earth.createInstance('map3d', initCB, failureCB);
        }

        function initCB(instance) {
            ge = instance;

            // Show time control slider
            ge.getTime().getControl().setVisibility(ge.VISIBILITY_SHOW);

            animTeroid(data[0], 'ff00ff99');
            animTeroid(data[1], 'ffff9900');
            animTeroid(data[2], 'ff9900ff');
            animTeroid(data[3], 'ff0099ff');
            animTeroid(data[4], 'ff99ff00');
            animTeroid(data[5], 'ffff0099');

            // Draw and show the earth
            ge.getWindow().setVisibility(true);
        }

        function failureCB(errorCode) {
        }

        // Draw asteroid data
        function animTeroid(ast, color) {
            console.log('Processing asteroid:', ast.name);
            // For each position in history
            var start = '2014';
            for (var i = 0; i < ast.pos.length; i++ ) {
                var p = ast.pos[i];
                if( p.date <= start ) {
                    continue;
                }
                var radius = (30 - p.alt) * 0.07;
                var thing = polyThing(radius, p.lat, p.lon, start, p.date, color);
                start = p.date; // save to start next thingy
                ge.getFeatures().appendChild(thing);
            }
        }

        // Draw a thing on the map
        function polyThing(radius, lat, lon, begin, end, color) {
            var timeSpan = ge.createTimeSpan('');
            timeSpan.getBegin().set(begin);
            timeSpan.getEnd().set(end);

            var placemark = ge.createPlacemark('');
            placemark.setTimePrimitive(timeSpan);
            placemark.setGeometry(ge.createPolygon(''));

            var thing = makeThing(radius, lat, lon);
            placemark.getGeometry().setOuterBoundary(thing);

            //Create a style and set color of thing
            placemark.setStyleSelector(ge.createStyle(''));
            var car = placemark.getStyleSelector().getPolyStyle().getColor();
            car.set(color);

            return placemark;
        }

        function makeThing(radius, lat, lon) {
            var ring = ge.createLinearRing('');
            ring.getCoordinates().pushLatLngAlt(lat + radius, lon, 1000);
            ring.getCoordinates().pushLatLngAlt(lat, lon + radius, 1000);
            ring.getCoordinates().pushLatLngAlt(lat - radius, lon, 1000);
            ring.getCoordinates().pushLatLngAlt(lat, lon - radius, 1000);
            return ring;
        }

        // Start the show!
        google.setOnLoadCallback(init);
    </script>
  </head>
  <body>
      <!--<div id="map3d" style="height: 400px; width: 600px;"></div>-->
    <div id="map3d"></div>
  </body>
</html>
